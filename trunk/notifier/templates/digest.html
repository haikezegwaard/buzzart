<!DOCTYPE html>
<html>
    <head>
        <!--Load the AJAX API-->
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript">
            // Load the Visualization API and the piechart package.
            google.load('visualization', '1.0', {'packages':['corechart','gauge']});

            // Set a callback to run when the Google Visualization API is loaded.
            google.setOnLoadCallback(drawChart);

            // Callback that creates and populates a data table,
            // instantiates the pie chart, passes in the data and
            // draws it.
            function drawChart() {

              var traffic_data = new google.visualization.DataTable();
              traffic_data.addColumn('string','Day');
              traffic_data.addColumn('number','Sessions');
              traffic_data.addColumn('number','Pageviews');
              {% for entry in traffic %}
                traffic_data.addRows([
                    ['{{entry.0}}',{{entry.1}},{{entry.2}}]
                ]);
              {% endfor %}
              var traffic_chart = new google.visualization.LineChart(document.getElementById('traffic_plot'));
              var traffic_options = {'title':'Traffic',
                                     'width':800,
                                     'height':200
                                     };

              //traffic_chart.draw(traffic_data,traffic_options);

                // Wait for the chart to finish drawing before calling the getImageURI() method.
                chart_div = document.getElementById('traffic_plot');
                google.visualization.events.addListener(traffic_chart, 'ready', function () {
                    chart_div.innerHTML = '<img src="' + traffic_chart.getImageURI() + '">';
                    console.log(chart_div.innerHTML);
                });

                traffic_chart.draw(traffic_data,traffic_options);

                //Interest Gauge
                var data = google.visualization.arrayToDataTable([
                    ['Label', 'Value'],
                    ['Interesse', {{interest}}]
                ]);
                var options = {
                    width: 400, height: 200,
                    redFrom: 0, redTo: 1,
                    yellowFrom:1, yellowTo: 3,
                    greenFrom: 3, greenTo: 6,
                    minorTicks: 5, max: 6
                };
                var chart = new google.visualization.Gauge(document.getElementById('interest_plot'));
                chart.draw(data, options);

                //Conversion Gauge
                var data = google.visualization.arrayToDataTable([
                    ['Label', 'Value'],
                    ['Conversies', {{conversions}}]
                ]);
                var options = {
                    width: 400, height: 200,
                    redFrom: 0, redTo: 3,
                    yellowFrom:3, yellowTo: 10,
                    greenFrom: 20, greenTo: 30,
                    minorTicks: 5, max: 30
                };
                var chart = new google.visualization.Gauge(document.getElementById('conversion_plot'));
                chart.draw(data, options);
            }
        </script>
    </head>
    <body>
        <!--Divs that will hold the charts-->
        <div id="traffic_plot"></div>
        <div id="interest_plot" style="width: 400px; height: 200px;"></div>
        <div id="conversion_plot" style="width: 400px; height: 200px;"></div>
        <h1>Conversieratio: {{conversionrate}}<small> (Vorige periode: {{previousconversionrate}})</small></h1>
    </body>
</html>
